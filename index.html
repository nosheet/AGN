<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AGN — Assistant de Génération de Notes</title>

  <style>
    :root {
      --bg: #f3f2ee;
      --card: #ffffff;
      --text: #14201c;
      --muted: #5a6661;
      --border: rgba(20,32,28,0.18);

      --primary: #2f7a67;
      --primary-2: #255f51;
      --accent: #b8924a;
      --accent-2: #8f7238;

      --shadow-soft: 0 2px 8px rgba(0,0,0,0.08);
      --btn-bg: #f4f4f4;
      --btn-border: rgba(20,32,28,0.25);
      --btn-text: var(--text);
      --focus: rgba(47, 122, 103, 0.35);

      --disabled: rgba(90, 102, 97, 0.55);
    }

    [data-theme="dark"] {
      --bg: #0f1413;
      --card: #141b19;
      --text: #e8f0ed;
      --muted: #b3c0bb;
      --border: rgba(232,240,237,0.18);

      --primary: #43a089;
      --primary-2: #2f7a67;
      --accent: #d1ad61;
      --accent-2: #b8924a;

      --shadow-soft: 0 2px 10px rgba(0,0,0,0.35);
      --btn-bg: rgba(232,240,237,0.06);
      --btn-border: rgba(232,240,237,0.22);
      --btn-text: var(--text);
      --focus: rgba(67, 160, 137, 0.35);

      --disabled: rgba(179, 192, 187, 0.55);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
    }

    .wrap { max-width: 1140px; margin: 0 auto; padding: 18px; }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: var(--shadow-soft);
    }

    header.card { display: flex; gap: 12px; align-items: center; justify-content: space-between; }
    .brand { display:flex; flex-direction: column; gap: 4px; }
    h1 { margin: 0; font-size: 22px; letter-spacing: 0.2px; }
    .sub { margin: 0; color: var(--muted); font-size: 13px; }
    .small { font-size: 12px; color: var(--muted); margin-top: 6px; }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 14px;
      align-items: start;
    }

    h2 { margin: 0 0 10px 0; font-size: 15px; }

    .control { margin-bottom: 12px; }
    .control label { display:block; font-weight: 650; margin-bottom: 6px; font-size: 13px; }

    select, textarea {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      background: var(--card);
      color: var(--text);
      font-size: 13px;
      outline: none;
    }
    option { background: var(--card); color: var(--text); }

    select:focus, textarea:focus, input[type="range"]:focus {
      box-shadow: 0 0 0 4px var(--focus);
    }

    .range-block { padding: 8px 10px; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 10px; }
    .range-head { display:flex; gap:10px; align-items:center; justify-content: space-between; margin-bottom: 6px; }
    .range-title { display:flex; gap:10px; align-items:center; font-size: 13px; font-weight: 650; }
    .range-title input[type="checkbox"] { transform: translateY(1px); }

    .range-row { display:flex; gap: 10px; align-items:center; }
    .range-row input[type="range"] { flex: 1; }
    .value { min-width: 320px; font-size: 12px; color: var(--muted); }

    .range-block.is-disabled { opacity: 0.75; }
    .range-block.is-disabled .range-title { color: var(--disabled); }
    .range-block.is-disabled .value { color: var(--disabled); }

    .radio-row { display:flex; gap: 14px; flex-wrap: wrap; font-size: 13px; }
    .radio-row label { font-weight: 500; color: var(--text); }

    .row { display:flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; align-items:center; }

    .btn {
      padding: 8px 11px;
      border: 1px solid var(--btn-border);
      background: var(--btn-bg);
      color: var(--btn-text);
      border-radius: 10px;
      cursor: pointer;
      font-size: 12px;
    }
    .btn-primary { border-color: transparent; background: var(--primary); color: #fff; }
    .btn-primary:hover { background: var(--primary-2); }
    .btn-accent { border-color: transparent; background: var(--accent); color: #1c1a14; }
    .btn-accent:hover { background: var(--accent-2); }

    .status { margin: 10px 0 0 0; font-size: 12px; color: var(--muted); min-height: 16px; }

    .preview {
      min-height: 120px;
      padding: 10px;
      border: 1px dashed var(--border);
      border-radius: 12px;
      background: rgba(0,0,0,0.02);
      white-space: pre-wrap;
      color: var(--text);
    }
    [data-theme="dark"] .preview { background: rgba(255,255,255,0.03); }

    textarea { min-height: 160px; resize: vertical; }

    .pill {
      display:inline-flex; align-items:center; gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 12px;
    }
    .pill b { color: var(--text); font-weight: 650; }

    .copy-row { display:flex; justify-content:flex-end; margin-top: 10px; }

    .inline-check {
      display:flex; align-items:center; gap: 8px;
      font-size: 12px; color: var(--muted);
      user-select: none;
    }
    .inline-check input { transform: translateY(1px); }

    .right-topbar {
      display:flex;
      gap: 10px;
      align-items: end;
      justify-content: flex-end;
      margin-bottom: 12px;
    }

    .toggle {
      display:flex; gap: 8px; align-items:center;
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: transparent;
      cursor: pointer;
      font-size: 12px;
      color: var(--text);
      height: 38px;
      white-space: nowrap;
    }
    .dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: var(--primary);
      box-shadow: 0 0 0 3px var(--focus);
    }

    @media (max-width: 920px) {
      .grid { grid-template-columns: 1fr; }
      .value { min-width: 220px; }
      header.card { flex-direction: column; align-items: flex-start; }
      .right-topbar { justify-content: flex-start; }
      .toggle { justify-content: center; }
    }
  
      .range-flags{display:flex;gap:10px;align-items:center;font-size:12px;opacity:.9}
      .mini-flag{display:flex;align-items:center;gap:6px;cursor:pointer;user-select:none}
      .mini-flag input{cursor:pointer}
    </style>
</head>

<body>
  <div class="wrap">
    <header class="card">
      <div class="brand">
        <h1>AGN</h1>
        <p class="sub">Assistant de génération de notes cliniques (hors ligne). Outil générique.</p>
        <div class="small">Générez puis copiez/collez dans Word, dossier patient, formulaire, etc.</div>
      </div>
      <div></div>
    </header>

    <main class="grid">
      <!-- LEFT -->
      <section class="card">
        <h2>Filtre</h2>
        <div class="control">
          <label for="domainSelect">Domaine</label>
          <select id="domainSelect"></select>
          <div class="small">Vide = tous les paramètres visibles</div>
        </div>

        <div class="row" style="margin-top: 4px;">
          <span class="pill">Paramètres visibles: <b id="visibleCount">0</b></span>

          <label class="inline-check" title="Ajoute le texte généré à la suite au lieu de remplacer">
            <input id="appendMode" type="checkbox" />
            Ajouter au texte
          </label>
        </div>

        <h2 style="margin-top:14px;">Paramètres</h2>
        <div id="controls"></div>

        <div class="row">
          <button id="btnPreview" class="btn btn-primary" type="button">Prévisualiser</button>
          <button id="btnClear" class="btn" type="button">Effacer</button>
        </div>

        <p id="status" class="status"></p>
      </section>

      <!-- RIGHT -->
      <section class="card">
        <div class="right-topbar">
          <button id="themeToggle" class="toggle" type="button" title="Basculer clair/sombre">
            <span class="dot" aria-hidden="true"></span>
            <span id="themeLabel">Mode sombre</span>
          </button>
        </div>

        <h2>Texte généré</h2>
        <div id="preview" class="preview" aria-label="Prévisualisation"></div>

        <h2 style="margin-top:12px;">Zone de note (optionnel)</h2>
        <textarea id="noteBox" placeholder="Vous pouvez ajuster le texte ici avant de copier..."></textarea>

        <div class="copy-row">
          <button id="btnCopy" class="btn btn-accent" type="button">Copier</button>
        </div>
      </section>
    </main>
  </div>

  <!-- ========================= DATA ========================= -->

  <script id="domains-json" type="application/json">
[
  "Perception / cognition (attention, orientation, sensations)",
  "Douleur",
  "Comportement face à la santé / Apprendre (sensibilisation à la santé, bien-être-confort)",
  "Principes de vie (valeurs, croyances, autonomie)",
  "Communiquer",
  "Sécurité / protection (hygiène, état cutané, risque de chute, infection, circulation sanguine)",
  "Mise en danger de soi / d'autrui (violence)",
  "Perception de soi (peur, espoir, etc.)",
  "Rôles sociaux (aidant naturel, relation familiales, rôles démontrés)",
  "Se mobiliser/motricité",
  "S'occuper / gérer le quotidien / potentiel d'énergie",
  "Boire /Manger (aliments/liquides absorbés, digestion, métabolisme)",
  "Dormir/Se reposer",
  "Soins corporels / habillement",
  "Respirer",
  "Eliminer (fonctionnement du système urinaire/digestif)"
]
  </script>

  <!-- Full parameters list (yours) -->
  <script id="parameters-json" type="application/json">
{
  "gender": { "type": "radio", "label": "Sexe du patient", "values": ["M", "F"], "default": "M", "display": { "M": "Homme", "F": "Femme" } },

  "cog_orientation": { "type":"range", "label":"Orientation spatio-temporelle", "min":0, "max":5, "default":1, "domain":"Perception / cognition (attention, orientation, sensations)" },
  "cog_attention": { "type":"range", "label":"Attention / concentration", "min":0, "max":5, "default":1, "domain":"Perception / cognition (attention, orientation, sensations)" },
  "cog_memoire": { "type":"range", "label":"Mémoire / oublis", "min":0, "max":5, "default":1, "domain":"Perception / cognition (attention, orientation, sensations)" },
  "cog_jugement": { "type":"range", "label":"Jugement / prise de décision", "min":0, "max":5, "default":1, "domain":"Perception / cognition (attention, orientation, sensations)" },
  "cog_sens": { "type":"range", "label":"Perception sensorielle (vue/ouïe)", "min":0, "max":5, "default":0, "domain":"Perception / cognition (attention, orientation, sensations)" },
  "cog_comprehension": { "type":"range", "label":"Compréhension des situations", "min":0, "max":5, "default":1, "domain":"Perception / cognition (attention, orientation, sensations)" },

  "douleur": { "type":"range", "label":"Douleur (intensité)", "min":0, "max":5, "default":1, "domain":"Douleur" },
  "douleur_impact": { "type":"range", "label":"Douleur (impact fonctionnel)", "min":0, "max":5, "default":1, "domain":"Douleur" },
  "douleur_traitement": { "type":"range", "label":"Besoin d’antalgiques / suivi", "min":0, "max":5, "default":1, "domain":"Douleur" },

  "sante_observance": { "type":"range", "label":"Adhésion aux soins / consignes", "min":0, "max":5, "default":1, "domain":"Comportement face à la santé / Apprendre (sensibilisation à la santé, bien-être-confort)" },
  "sante_education": { "type":"range", "label":"Besoin d’enseignement / compréhension", "min":0, "max":5, "default":1, "domain":"Comportement face à la santé / Apprendre (sensibilisation à la santé, bien-être-confort)" },
  "sante_confort": { "type":"range", "label":"Bien-être / confort (mesures non médicamenteuses)", "min":0, "max":5, "default":1, "domain":"Comportement face à la santé / Apprendre (sensibilisation à la santé, bien-être-confort)" },

  "valeurs_autonomie": { "type":"range", "label":"Autonomie décisionnelle", "min":0, "max":5, "default":1, "domain":"Principes de vie (valeurs, croyances, autonomie)" },
  "valeurs_motivation": { "type":"range", "label":"Motivation / participation aux objectifs", "min":0, "max":5, "default":1, "domain":"Principes de vie (valeurs, croyances, autonomie)" },
  "valeurs_acceptation": { "type":"range", "label":"Acceptation de l’aide (soins/AVQ)", "min":0, "max":5, "default":1, "domain":"Principes de vie (valeurs, croyances, autonomie)" },

  "comm_comprehension": { "type":"range", "label":"Compréhension (consignes/échanges)", "min":0, "max":5, "default":1, "domain":"Communiquer" },
  "comm_expression": { "type":"range", "label":"Expression (parole/gestes)", "min":0, "max":5, "default":1, "domain":"Communiquer" },
  "comm_aides": { "type":"range", "label":"Besoin d’aides à la communication", "min":0, "max":5, "default":0, "domain":"Communiquer" },
  "comm_langue": { "type":"range", "label":"Barrière de langue / compréhension culturelle", "min":0, "max":5, "default":0, "domain":"Communiquer" },

  "secu_chute": { "type":"range", "label":"Risque de chute", "min":0, "max":5, "default":1, "domain":"Sécurité / protection (hygiène, état cutané, risque de chute, infection, circulation sanguine)" },
  "secu_peau": { "type":"range", "label":"Intégrité cutanée / risque d’escarres", "min":0, "max":5, "default":1, "domain":"Sécurité / protection (hygiène, état cutané, risque de chute, infection, circulation sanguine)" },
  "secu_infection": { "type":"range", "label":"Risque infectieux (surveillance)", "min":0, "max":5, "default":1, "domain":"Sécurité / protection (hygiène, état cutané, risque de chute, infection, circulation sanguine)" },
  "secu_hygiene": { "type":"range", "label":"Hygiène (besoin de supervision)", "min":0, "max":5, "default":1, "domain":"Sécurité / protection (hygiène, état cutané, risque de chute, infection, circulation sanguine)" },
  "secu_circulation": { "type":"range", "label":"Circulation / œdèmes (surveillance)", "min":0, "max":5, "default":0, "domain":"Sécurité / protection (hygiène, état cutané, risque de chute, infection, circulation sanguine)" },
  "secu_medic": { "type":"range", "label":"Sécurité médicamenteuse / suivi", "min":0, "max":5, "default":0, "domain":"Sécurité / protection (hygiène, état cutané, risque de chute, infection, circulation sanguine)" },

  "danger_agressivite": { "type":"range", "label":"Risque d’agressivité / conflit", "min":0, "max":5, "default":0, "domain":"Mise en danger de soi / d'autrui (violence)" },
  "danger_impulsivite": { "type":"range", "label":"Impulsivité / comportements à risque", "min":0, "max":5, "default":0, "domain":"Mise en danger de soi / d'autrui (violence)" },
  "danger_fugue": { "type":"range", "label":"Risque de fugue / errance", "min":0, "max":5, "default":0, "domain":"Mise en danger de soi / d'autrui (violence)" },

  "soi_humeur": { "type":"range", "label":"Humeur (tristesse/irritabilité)", "min":0, "max":5, "default":1, "domain":"Perception de soi (peur, espoir, etc.)" },
  "soi_anxiete": { "type":"range", "label":"Anxiété / inquiétude", "min":0, "max":5, "default":1, "domain":"Perception de soi (peur, espoir, etc.)" },
  "soi_estime": { "type":"range", "label":"Estime de soi / confiance", "min":0, "max":5, "default":0, "domain":"Perception de soi (peur, espoir, etc.)" },

  "social_reseau": { "type":"range", "label":"Soutien familial / réseau", "min":0, "max":5, "default":1, "domain":"Rôles sociaux (aidant naturel, relation familiales, rôles démontrés)" },
  "social_participation": { "type":"range", "label":"Participation sociale / isolement", "min":0, "max":5, "default":1, "domain":"Rôles sociaux (aidant naturel, relation familiales, rôles démontrés)" },
  "social_aidant": { "type":"range", "label":"Charge de l’aidant / coordination", "min":0, "max":5, "default":0, "domain":"Rôles sociaux (aidant naturel, relation familiales, rôles démontrés)" },

  "mob_transferts": { "type":"range", "label":"Transferts (lit-fauteuil, lever)", "min":0, "max":5, "default":1, "domain":"Se mobiliser/motricité" },
  "mob_marche": { "type":"range", "label":"Marche / déplacements", "min":0, "max":5, "default":1, "domain":"Se mobiliser/motricité" },
  "mob_equilibre": { "type":"range", "label":"Équilibre / stabilité", "min":0, "max":5, "default":1, "domain":"Se mobiliser/motricité" },
  "mob_aides": { "type":"range", "label":"Besoin d’aide technique (canne, rollator)", "min":0, "max":5, "default":0, "domain":"Se mobiliser/motricité" },
  "mob_escalier": { "type":"range", "label":"Escaliers / franchissements", "min":0, "max":5, "default":0, "domain":"Se mobiliser/motricité" },
  "mob_endurance": { "type":"range", "label":"Tolérance à l’effort / essoufflement à la marche", "min":0, "max":5, "default":0, "domain":"Se mobiliser/motricité" },

  "energie_fatigue": { "type":"range", "label":"Fatigue / endurance", "min":0, "max":5, "default":1, "domain":"S'occuper / gérer le quotidien / potentiel d'énergie" },
  "activites_quot": { "type":"range", "label":"Activités quotidiennes (organisation)", "min":0, "max":5, "default":1, "domain":"S'occuper / gérer le quotidien / potentiel d'énergie" },
  "gestion_taches": { "type":"range", "label":"Gestion tâches simples (repères, routine)", "min":0, "max":5, "default":1, "domain":"S'occuper / gérer le quotidien / potentiel d'énergie" },

  "alim_appetit": { "type":"range", "label":"Appétit / prises alimentaires", "min":0, "max":5, "default":1, "domain":"Boire /Manger (aliments/liquides absorbés, digestion, métabolisme)" },
  "alim_hydratation": { "type":"range", "label":"Hydratation / surveillance", "min":0, "max":5, "default":1, "domain":"Boire /Manger (aliments/liquides absorbés, digestion, métabolisme)" },
  "alim_deglutition": { "type":"range", "label":"Déglutition / risque de fausse route", "min":0, "max":5, "default":0, "domain":"Boire /Manger (aliments/liquides absorbés, digestion, métabolisme)" },
  "alim_aide": { "type":"range", "label":"Aide au repas (coupe, stimulation, assistance)", "min":0, "max":5, "default":1, "domain":"Boire /Manger (aliments/liquides absorbés, digestion, métabolisme)" },
  "alim_regime": { "type":"range", "label":"Régime / consignes alimentaires", "min":0, "max":5, "default":0, "domain":"Boire /Manger (aliments/liquides absorbés, digestion, métabolisme)" },
  "alim_digestif": { "type":"range", "label":"Inconfort digestif / nausées", "min":0, "max":5, "default":0, "domain":"Boire /Manger (aliments/liquides absorbés, digestion, métabolisme)" },

  "sommeil_qualite": { "type":"range", "label":"Qualité du sommeil", "min":0, "max":5, "default":1, "domain":"Dormir/Se reposer" },
  "sommeil_reveils": { "type":"range", "label":"Réveils nocturnes / agitation", "min":0, "max":5, "default":1, "domain":"Dormir/Se reposer" },
  "sommeil_sieste": { "type":"range", "label":"Somnolence diurne / siestes", "min":0, "max":5, "default":0, "domain":"Dormir/Se reposer" },

  "avq_toilette": { "type":"range", "label":"Toilette / hygiène", "min":0, "max":5, "default":1, "domain":"Soins corporels / habillement" },
  "avq_habillage": { "type":"range", "label":"Habillage", "min":0, "max":5, "default":1, "domain":"Soins corporels / habillement" },
  "avq_soins": { "type":"range", "label":"Soins corporels spécifiques (peau, ongles)", "min":0, "max":5, "default":0, "domain":"Soins corporels / habillement" },
  "avq_transferts_wc": { "type":"range", "label":"Aller aux WC / gestion toilettes", "min":0, "max":5, "default":1, "domain":"Soins corporels / habillement" },

  "resp_dyspnee": { "type":"range", "label":"Dyspnée / essoufflement", "min":0, "max":5, "default":0, "domain":"Respirer" },
  "resp_oxygeno": { "type":"range", "label":"Besoin d’oxygène / surveillance", "min":0, "max":5, "default":0, "domain":"Respirer" },
  "resp_toux": { "type":"range", "label":"Toux / encombrement", "min":0, "max":5, "default":0, "domain":"Respirer" },

  "elim_urinaire": { "type":"range", "label":"Élimination urinaire (continence)", "min":0, "max":5, "default":1, "domain":"Eliminer (fonctionnement du système urinaire/digestif)" },
  "elim_transit": { "type":"range", "label":"Transit / constipation", "min":0, "max":5, "default":1, "domain":"Eliminer (fonctionnement du système urinaire/digestif)" },
  "elim_surv": { "type":"range", "label":"Surveillance (diurèse, selles)", "min":0, "max":5, "default":0, "domain":"Eliminer (fonctionnement du système urinaire/digestif)" },
  "elim_aide": { "type":"range", "label":"Aide nécessaire (protections, changes)", "min":0, "max":5, "default":1, "domain":"Eliminer (fonctionnement du système urinaire/digestif)" }
}
  </script>

  <!-- Keep your phrases-json; you can extend later -->
  <script id="phrases-json" type="application/json">

{
  "cog_orientation": {
    "M": [
      "Orientation spatio-temporelle préservée",
      "Orientation spatio-temporelle globalement adéquate, avec rares épisodes confusionnels",
      "Orientation spatio-temporelle fluctuante, avec besoin de rappels ponctuels",
      "Orientation spatio-temporelle altérée, nécessitant un réajustement régulier",
      "Orientation spatio-temporelle très limitée, avec besoin de guidage rapproché",
      "Orientation spatio-temporelle fortement altérée, avec réorientation quasi constante"
    ],
    "F": [
      "Orientation spatio-temporelle préservée",
      "Orientation spatio-temporelle globalement adéquate, avec épisodes confusionnels",
      "Orientation spatio-temporelle fluctuante, avec besoin de rappels ponctuels",
      "Orientation spatio-temporelle altérée, nécessitant un réajustement régulier",
      "Orientation spatio-temporelle très limitée, avec besoin de guidage rapproché",
      "Orientation spatio-temporelle fortement altérée, avec réorientation quasi constante"
    ]
  },
  "cog_attention": {
    "M": [
      "Concentration préservée",
      "Concentration globalement adéquate, avec une fatigabilité légère",
      "Concentration fluctuante, avec relances ponctuelles nécessaires",
      "Concentration réduite, avec besoin de guidage fréquent",
      "Concentration très limitée, avec supervision étroite lors des activités",
      "Concentration fortement altérée, nécessitant un accompagnement constant"
    ],
    "F": [
      "Concentration préservée",
      "Concentration globalement adéquate, avec une fatigabilité légère",
      "Concentration fluctuante, avec relances ponctuelles nécessaires",
      "Concentration réduite, avec besoin de guidage fréquent",
      "Concentration très limitée, avec supervision étroite lors des activités",
      "Concentration fortement altérée, nécessitant un accompagnement constant"
    ]
  },
  "cog_memoire": {
    "M": [
      "Oublis sans élément marquant",
      "Oublis occasionnels, sans un impact majeur",
      "Oublis fréquents, avec besoin de rappels",
      "Oublis répétés, nécessitant des repères et une structure",
      "Oublis très présents, avec besoin d’aide pour se repérer au quotidien",
      "Oublis majeurs, avec dépendance importante aux repères externes"
    ],
    "F": [
      "Oublis sans élément marquant",
      "Oublis occasionnels, sans un impact majeur",
      "Oublis fréquents, avec besoin de rappels",
      "Oublis répétés, nécessitant des repères et une structure",
      "Oublis très présents, avec besoin d’aide pour se repérer au quotidien",
      "Oublis majeurs, avec dépendance importante aux repères externes"
    ]
  },
  "cog_jugement": {
    "M": [
      "Prise de décision adaptés",
      "Prise de décision globalement cohérents, avec besoin de clarification ponctuelle",
      "Prise de décision hésitants, avec guidance ponctuelle",
      "Prise de décision altérés, nécessitant un encadrement régulier",
      "Prise de décision très limités, avec décisions à sécuriser systématiquement",
      "Prise de décision fortement compromise, nécessitant un encadrement constant"
    ],
    "F": [
      "Prise de décision adaptés",
      "Prise de décision globalement cohérents, avec besoin de clarification ponctuelle",
      "Prise de décision hésitants, avec guidance ponctuelle",
      "Prise de décision altérés, nécessitant un encadrement régulier",
      "Prise de décision très limités, avec décisions à sécuriser systématiquement",
      "Prise de décision fortement compromise, nécessitant un encadrement constant"
    ]
  },
  "cog_sens": {
    "M": [
      "Perception sensorielle fonctionnelle",
      "Perception sensorielle légèrement diminuée, avec compensation efficace",
      "Perception sensorielle diminuée, avec besoin d’adaptations",
      "Perception sensorielle nettement diminuée, avec impacts sur les échanges et activités",
      "Perception sensorielle très réduite, nécessitant des stratégies de communication adaptées",
      "Perception sensorielle fortement déficitaire, avec besoin d’un accompagnement étroit"
    ],
    "F": [
      "Perception sensorielle fonctionnelle",
      "Perception sensorielle légèrement diminuée, avec compensation efficace",
      "Perception sensorielle diminuée, avec besoin d’adaptations",
      "Perception sensorielle nettement diminuée, avec impacts sur les échanges et activités",
      "Perception sensorielle très réduite, nécessitant des stratégies de communication adaptées",
      "Perception sensorielle fortement déficitaire, avec besoin d’un accompagnement étroit"
    ]
  },
  "cog_comprehension": {
    "M": [
      "Compréhension des situations adéquate",
      "Compréhension des situations globalement bonne, avec explications simples nécessaires",
      "Compréhension des situations fluctuante, nécessitant reformulations",
      "Compréhension des situations limitée, avec besoin d’explications répétées",
      "Compréhension des situations très réduite, avec consignes à simplifier systématiquement",
      "Compréhension des situations fortement altérée, avec accompagnement constant pour se repérer"
    ],
    "F": [
      "Compréhension des situations adéquate",
      "Compréhension des situations globalement bonne, avec explications simples nécessaires",
      "Compréhension des situations fluctuante, nécessitant reformulations",
      "Compréhension des situations limitée, avec besoin d’explications répétées",
      "Compréhension des situations très réduite, avec consignes à simplifier systématiquement",
      "Compréhension des situations fortement altérée, avec accompagnement constant pour se repérer"
    ]
  },
  "douleur": {
    "M": [
      "aucune plainte douloureuse rapportée",
      "douleurs discrètes, bien tolérées",
      "douleurs présentes, nécessitant des ajustements au quotidien",
      "douleurs fréquentes, avec inconfort marqué",
      "douleurs importantes, limitant les activités",
      "douleurs très importantes, avec inconfort quasi constant"
    ],
    "F": [
      "aucune plainte douloureuse rapportée",
      "douleurs discrètes, bien tolérées",
      "douleurs présentes, nécessitant des ajustements au quotidien",
      "douleurs fréquentes, avec inconfort marqué",
      "douleurs importantes, limitant les activités",
      "douleurs très importantes, avec inconfort quasi constant"
    ]
  },
  "douleur_impact": {
    "M": [
      "douleurs sans un impact fonctionnel notable",
      "douleurs avec un impact léger sur certaines activités",
      "douleurs avec un impact modéré, entraînant des pauses et adaptations",
      "douleurs avec un impact important, limitant la mobilisation et/ou les soins",
      "douleurs avec un impact très important, entravant significativement les activités",
      "douleurs avec un impact majeur, rendant plusieurs activités difficilement réalisables"
    ],
    "F": [
      "douleurs sans un impact fonctionnel notable",
      "douleurs avec un impact léger sur certaines activités",
      "douleurs avec un impact modéré, entraînant des pauses et adaptations",
      "douleurs avec un impact important, limitant la mobilisation et/ou les soins",
      "douleurs avec un impact très important, entravant significativement les activités",
      "douleurs avec un impact majeur, rendant plusieurs activités difficilement réalisables"
    ]
  },
  "douleur_traitement": {
    "M": [
      "Besoin d’antalgiques / suivi non exprimé à ce stade",
      "Besoin d’antalgiques / suivi ponctuel, selon les besoins",
      "Besoin d’antalgiques / suivi régulier, avec réévaluation",
      "Besoin d’antalgiques / suivi fréquent, avec adaptation du traitement",
      "Besoin d’antalgiques / suivi très rapproché, avec surveillance de l’efficacité",
      "Besoin d’antalgiques / suivi constant, avec ajustements répétés"
    ],
    "F": [
      "Besoin d’antalgiques / suivi non exprimé à ce stade",
      "Besoin d’antalgiques / suivi ponctuel, selon les besoins",
      "Besoin d’antalgiques / suivi régulier, avec réévaluation",
      "Besoin d’antalgiques / suivi fréquent, avec adaptation du traitement",
      "Besoin d’antalgiques / suivi très rapproché, avec surveillance de l’efficacité",
      "Besoin d’antalgiques / suivi constant, avec ajustements répétés"
    ]
  },
  "sante_observance": {
    "M": [
      "Adhésion aux soins bonne",
      "Adhésion aux soins globalement bonne, avec rappels ponctuels",
      "Adhésion aux soins fluctuante, nécessitant encouragements et explications",
      "Adhésion aux soins difficile, avec refus intermittents",
      "Adhésion aux soins très difficile, avec opposition fréquente",
      "Adhésion aux soins quasi impossible, nécessitant approche très progressive"
    ],
    "F": [
      "Adhésion aux soins bonne",
      "Adhésion aux soins globalement bonne, avec rappels ponctuels",
      "Adhésion aux soins fluctuante, nécessitant encouragements et explications",
      "Adhésion aux soins difficile, avec refus intermittents",
      "Adhésion aux soins très difficile, avec opposition fréquente",
      "Adhésion aux soins quasi impossible, nécessitant approche très progressive"
    ]
  },
  "sante_education": {
    "M": [
      "Besoin d’enseignement limité",
      "Besoin d’enseignement léger, avec messages simples",
      "Besoin d’enseignement présent, avec renforcement régulier",
      "Besoin d’enseignement important, avec répétitions et supports",
      "Besoin d’enseignement très important, avec guidance étroite",
      "Besoin d’enseignement majeur, avec accompagnement continu"
    ],
    "F": [
      "Besoin d’enseignement limité",
      "Besoin d’enseignement léger, avec messages simples",
      "Besoin d’enseignement présent, avec renforcement régulier",
      "Besoin d’enseignement important, avec répétitions et supports",
      "Besoin d’enseignement très important, avec guidance étroite",
      "Besoin d’enseignement majeur, avec accompagnement continu"
    ]
  },
  "sante_confort": {
    "M": [
      "Bien-être satisfaisant",
      "Bien-être globalement satisfaisant, avec mesures de confort ponctuelles",
      "Bien-être fluctuant, nécessitant des ajustements réguliers",
      "Bien-être altéré, avec besoins de confort fréquents",
      "Bien-être très altéré, nécessitant des interventions rapprochées",
      "Bien-être fortement compromis, avec besoin d’un soutien constant"
    ],
    "F": [
      "Bien-être satisfaisant",
      "Bien-être globalement satisfaisant, avec mesures de confort ponctuelles",
      "Bien-être fluctuant, nécessitant des ajustements réguliers",
      "Bien-être altéré, avec besoins de confort fréquents",
      "Bien-être très altéré, nécessitant des interventions rapprochées",
      "Bien-être fortement compromis, avec besoin d’un soutien constant"
    ]
  },
  "valeurs_autonomie": {
    "M": [
      "Autonomie décisionnelle préservée",
      "Autonomie décisionnelle globalement préservée, avec besoin de clarification",
      "Autonomie décisionnelle fluctuante, avec soutien pour exprimer les choix",
      "Autonomie décisionnelle limitée, nécessitant une guidance régulière",
      "Autonomie décisionnelle très réduite, avec décisions à soutenir étroitement",
      "Autonomie décisionnelle fortement réduite, avec décisions assumées en grande partie par l’entourage/équipe"
    ],
    "F": [
      "Autonomie décisionnelle préservée",
      "Autonomie décisionnelle globalement préservée, avec besoin de clarification",
      "Autonomie décisionnelle fluctuante, avec soutien pour exprimer les choix",
      "Autonomie décisionnelle limitée, nécessitant une guidance régulière",
      "Autonomie décisionnelle très réduite, avec décisions à soutenir étroitement",
      "Autonomie décisionnelle fortement réduite, avec décisions assumées en grande partie par l’entourage/équipe"
    ]
  },
  "valeurs_motivation": {
    "M": [
      "Participation aux objectifs bonne",
      "Participation aux objectifs globalement bonne, avec encouragements ponctuels",
      "Participation aux objectifs variable, avec besoin de stimulation",
      "Participation aux objectifs faible, nécessitant encouragements réguliers",
      "Participation aux objectifs très faible, avec participation limitée",
      "Participation aux objectifs quasi absente, avec adhésion difficile"
    ],
    "F": [
      "Participation aux objectifs bonne",
      "Participation aux objectifs globalement bonne, avec encouragements ponctuels",
      "Participation aux objectifs variable, avec besoin de stimulation",
      "Participation aux objectifs faible, nécessitant encouragements réguliers",
      "Participation aux objectifs très faible, avec participation limitée",
      "Participation aux objectifs quasi absente, avec adhésion difficile"
    ]
  },
  "valeurs_acceptation": {
    "M": [
      "Acceptation de l’aide (soins/AVQ) bonne",
      "Acceptation de l’aide (soins/AVQ) globalement bonne, avec hésitations ponctuelles",
      "Acceptation de l’aide (soins/AVQ) fluctuante, nécessitant une approche rassurante",
      "Acceptation de l’aide (soins/AVQ) difficile, avec résistances régulières",
      "Acceptation de l’aide (soins/AVQ) très difficile, avec refus fréquents",
      "Acceptation de l’aide (soins/AVQ) quasi impossible, nécessitant négociation et progression"
    ],
    "F": [
      "Acceptation de l’aide (soins/AVQ) bonne",
      "Acceptation de l’aide (soins/AVQ) globalement bonne, avec hésitations ponctuelles",
      "Acceptation de l’aide (soins/AVQ) fluctuante, nécessitant une approche rassurante",
      "Acceptation de l’aide (soins/AVQ) difficile, avec résistances régulières",
      "Acceptation de l’aide (soins/AVQ) très difficile, avec refus fréquents",
      "Acceptation de l’aide (soins/AVQ) quasi impossible, nécessitant négociation et progression"
    ]
  },
  "comm_expression": {
    "M": [
      "Expression claire",
      "Expression globalement compréhensible, avec lenteur légère",
      "Expression fluctuante, avec recherche de mots et besoin de temps",
      "Expression limitée, avec besoin d’aide pour se faire comprendre",
      "Expression très limitée, recours fréquent aux gestes/indications",
      "Expression quasi impossible, communication surtout non verbale"
    ],
    "F": [
      "Expression claire",
      "Expression globalement compréhensible, avec lenteur légère",
      "Expression fluctuante, avec recherche de mots et besoin de temps",
      "Expression limitée, avec besoin d’aide pour se faire comprendre",
      "Expression très limitée, recours fréquent aux gestes/indications",
      "Expression quasi impossible, communication surtout non verbale"
    ]
  },
  "comm_comprehension": {
    "M": [
      "Compréhension adéquate",
      "Compréhension globalement bonne, avec répétitions ponctuelles",
      "Compréhension fluctuante, nécessitant reformulations",
      "Compréhension limitée, consignes à simplifier régulièrement",
      "Compréhension très réduite, avec besoin d’un accompagnement rapproché",
      "Compréhension fortement altérée, échanges très restreints"
    ],
    "F": [
      "Compréhension adéquate",
      "Compréhension globalement bonne, avec répétitions ponctuelles",
      "Compréhension fluctuante, nécessitant reformulations",
      "Compréhension limitée, consignes à simplifier régulièrement",
      "Compréhension très réduite, avec besoin d’un accompagnement rapproché",
      "Compréhension fortement altérée, échanges très restreints"
    ]
  },
  "comm_aides": {
    "M": [
      "Besoin d’aides à la communication absent",
      "Besoin d’aides à la communication ponctuel (parler lentement, vérifier la compréhension)",
      "Besoin d’aides à la communication régulier (phrases courtes, supports visuels)",
      "Besoin d’aides à la communication important (répétitions, reformulations, gestes)",
      "Besoin d’aides à la communication très important, avec stratégies systématiques",
      "Besoin d’aides à la communication majeur, avec support constant"
    ],
    "F": [
      "Besoin d’aides à la communication absent",
      "Besoin d’aides à la communication ponctuel (parler lentement, vérifier la compréhension)",
      "Besoin d’aides à la communication régulier (phrases courtes, supports visuels)",
      "Besoin d’aides à la communication important (répétitions, reformulations, gestes)",
      "Besoin d’aides à la communication très important, avec stratégies systématiques",
      "Besoin d’aides à la communication majeur, avec support constant"
    ]
  },
  "comm_langue": {
    "M": [
      "Barrière de langue / compréhension culturelle non relevée",
      "Barrière de langue / compréhension culturelle légère, gérable avec langage simple",
      "Barrière de langue / compréhension culturelle présente, nécessitant adaptations",
      "Barrière de langue / compréhension culturelle importante, avec besoin d’un relais (famille/interprète)",
      "Barrière de langue / compréhension culturelle très importante, échanges difficiles",
      "Barrière de langue / compréhension culturelle majeure, communication fortement entravée"
    ],
    "F": [
      "Barrière de langue / compréhension culturelle non relevée",
      "Barrière de langue / compréhension culturelle légère, gérable avec langage simple",
      "Barrière de langue / compréhension culturelle présente, nécessitant adaptations",
      "Barrière de langue / compréhension culturelle importante, avec besoin d’un relais (famille/interprète)",
      "Barrière de langue / compréhension culturelle très importante, échanges difficiles",
      "Barrière de langue / compréhension culturelle majeure, communication fortement entravée"
    ]
  },
  "secu_chute": {
    "M": [
      "Risque de chute non signalé à ce stade",
      "Risque de chute présent, avec vigilance ponctuelle",
      "Risque de chute notable, nécessitant surveillance lors des déplacements",
      "Risque de chute important, avec accompagnement régulier",
      "Risque de chute très important, avec encadrement rapproché et sécurisation de l’environnement",
      "Risque de chute majeur, avec accompagnement constant"
    ],
    "F": [
      "Risque de chute non signalé à ce stade",
      "Risque de chute présent, avec vigilance ponctuelle",
      "Risque de chute notable, nécessitant surveillance lors des déplacements",
      "Risque de chute important, avec accompagnement régulier",
      "Risque de chute très important, avec encadrement rapproché et sécurisation de l’environnement",
      "Risque de chute majeur, avec accompagnement constant"
    ]
  },
  "secu_peau": {
    "M": [
      "Intégrité cutanée sans particularité",
      "Intégrité cutanée à surveiller, avec peau fragile par endroits",
      "Intégrité cutanée nécessitant prévention (hydratation, changements de position)",
      "Intégrité cutanée avec zones à risque, mesures renforcées",
      "Intégrité cutanée très préoccupant, prévention rapprochée",
      "Intégrité cutanée majeur, surveillance et soins constants"
    ],
    "F": [
      "Intégrité cutanée sans particularité",
      "Intégrité cutanée à surveiller, avec peau fragile par endroits",
      "Intégrité cutanée nécessitant prévention (hydratation, changements de position)",
      "Intégrité cutanée avec zones à risque, mesures renforcées",
      "Intégrité cutanée très préoccupant, prévention rapprochée",
      "Intégrité cutanée majeur, surveillance et soins constants"
    ]
  },
  "secu_hygiene": {
    "M": [
      "Besoin de supervision non nécessaire",
      "Besoin de supervision léger, avec rappels ponctuels",
      "Besoin de supervision présent, avec guidance régulière",
      "Besoin de supervision important, avec aide partielle",
      "Besoin de supervision très important, avec réalisation en grande partie par l’équipe",
      "Besoin de supervision majeur, prise en charge complète"
    ],
    "F": [
      "Besoin de supervision non nécessaire",
      "Besoin de supervision léger, avec rappels ponctuels",
      "Besoin de supervision présent, avec guidance régulière",
      "Besoin de supervision important, avec aide partielle",
      "Besoin de supervision très important, avec réalisation en grande partie par l’équipe",
      "Besoin de supervision majeur, prise en charge complète"
    ]
  },
  "secu_infection": {
    "M": [
      "Risque infectieux non particulier",
      "Risque infectieux léger, avec vigilance de routine",
      "Risque infectieux présent, avec contrôles réguliers",
      "Risque infectieux important, avec surveillance rapprochée",
      "Risque infectieux très important, avec mesures de prévention renforcées",
      "Risque infectieux majeur, avec surveillance continue"
    ],
    "F": [
      "Risque infectieux non particulier",
      "Risque infectieux léger, avec vigilance de routine",
      "Risque infectieux présent, avec contrôles réguliers",
      "Risque infectieux important, avec surveillance rapprochée",
      "Risque infectieux très important, avec mesures de prévention renforcées",
      "Risque infectieux majeur, avec surveillance continue"
    ]
  },
  "secu_circulation": {
    "M": [
      "Circulation sans particularité",
      "Circulation avec signes discrets, à surveiller",
      "Circulation avec œdèmes modérés, mesures simples proposées",
      "Circulation avec œdèmes marqués, surveillance et mesures renforcées",
      "Circulation très perturbée, avec besoin de mesures rapprochées",
      "Circulation fortement perturbée, avec surveillance étroite"
    ],
    "F": [
      "Circulation sans particularité",
      "Circulation avec signes discrets, à surveiller",
      "Circulation avec œdèmes modérés, mesures simples proposées",
      "Circulation avec œdèmes marqués, surveillance et mesures renforcées",
      "Circulation très perturbée, avec besoin de mesures rapprochées",
      "Circulation fortement perturbée, avec surveillance étroite"
    ]
  },
  "secu_medic": {
    "M": [
      "Sécurité médicamenteuse assuré sans difficulté",
      "Sécurité médicamenteuse à soutenir ponctuellement (rappels, vérification)",
      "Sécurité médicamenteuse nécessitant une supervision régulière",
      "Sécurité médicamenteuse nécessitant une prise en charge partielle par l’équipe",
      "Sécurité médicamenteuse nécessitant une prise en charge quasi complète",
      "Sécurité médicamenteuse entièrement assuré par l’équipe, avec contrôles constants"
    ],
    "F": [
      "Sécurité médicamenteuse assuré sans difficulté",
      "Sécurité médicamenteuse à soutenir ponctuellement (rappels, vérification)",
      "Sécurité médicamenteuse nécessitant une supervision régulière",
      "Sécurité médicamenteuse nécessitant une prise en charge partielle par l’équipe",
      "Sécurité médicamenteuse nécessitant une prise en charge quasi complète",
      "Sécurité médicamenteuse entièrement assuré par l’équipe, avec contrôles constants"
    ]
  },
  "danger_fugue": {
    "M": [
      "Risque de fugue / errance non relevé",
      "Errance occasionnel, à surveiller",
      "Errance présent, avec besoin de repères et vigilance",
      "Risque de fugue important, nécessitant surveillance rapprochée",
      "Risque de fugue très important, avec encadrement quasi constant",
      "Risque de fugue majeur, avec sécurisation et accompagnement permanent"
    ],
    "F": [
      "Risque de fugue / errance non relevé",
      "Errance occasionnel, à surveiller",
      "Errance présent, avec besoin de repères et vigilance",
      "Risque de fugue important, nécessitant surveillance rapprochée",
      "Risque de fugue très important, avec encadrement quasi constant",
      "Risque de fugue majeur, avec sécurisation et accompagnement permanent"
    ]
  },
  "danger_impulsivite": {
    "M": [
      "Impulsivité non observés",
      "Impulsivité occasionnelle, avec recadrage ponctuel",
      "Impulsivité présente, nécessitant un cadre clair",
      "Impulsivité fréquente, avec besoin d’encadrement régulier",
      "Impulsivité très fréquentes, avec une surveillance rapprochée",
      "Impulsivité majeur, avec un encadrement constant"
    ],
    "F": [
      "Impulsivité non observés",
      "Impulsivité occasionnelle, avec recadrage ponctuel",
      "Impulsivité présente, nécessitant un cadre clair",
      "Impulsivité fréquente, avec besoin d’encadrement régulier",
      "Impulsivité très fréquentes, avec une surveillance rapprochée",
      "Impulsivité majeur, avec un encadrement constant"
    ]
  },
  "danger_agressivite": {
    "M": [
      "Risque d’agressivité non signalé",
      "Risque d’agressivité occasionnel, avec tension ponctuelle",
      "Risque d’agressivité présent, nécessitant approche apaisante",
      "Risque d’agressivité important, avec épisodes réguliers",
      "Risque d’agressivité très important, avec besoin d’encadrement rapproché",
      "Risque d’agressivité majeur, avec risque élevé de décompensation comportementale"
    ],
    "F": [
      "Risque d’agressivité non signalé",
      "Risque d’agressivité occasionnel, avec tension ponctuelle",
      "Risque d’agressivité présent, nécessitant approche apaisante",
      "Risque d’agressivité important, avec épisodes réguliers",
      "Risque d’agressivité très important, avec besoin d’encadrement rapproché",
      "Risque d’agressivité majeur, avec risque élevé de décompensation comportementale"
    ]
  },
  "soi_anxiete": {
    "M": [
      "Anxiété non marquée",
      "Anxiété légère, avec besoin de réassurance ponctuelle",
      "Anxiété présente, avec besoin d’écoute et de soutien",
      "Anxiété importante, avec réassurance régulière",
      "Anxiété très importante, avec un impact sur le quotidien",
      "Anxiété majeure, nécessitant un soutien constant"
    ],
    "F": [
      "Anxiété non marquée",
      "Anxiété légère, avec besoin de réassurance ponctuelle",
      "Anxiété présente, avec besoin d’écoute et de soutien",
      "Anxiété importante, avec réassurance régulière",
      "Anxiété très importante, avec un impact sur le quotidien",
      "Anxiété majeure, nécessitant un soutien constant"
    ]
  },
  "soi_humeur": {
    "M": [
      "Humeur stable",
      "Humeur légèrement fluctuante",
      "Humeur fluctuante, avec irritabilité/tristesse par moments",
      "Humeur altérée, avec épisodes réguliers",
      "Humeur très altérée, avec un impact important",
      "Humeur fortement altérée, avec besoin de soutien rapproché"
    ],
    "F": [
      "Humeur stable",
      "Humeur légèrement fluctuante",
      "Humeur fluctuante, avec irritabilité/tristesse par moments",
      "Humeur altérée, avec épisodes réguliers",
      "Humeur très altérée, avec un impact important",
      "Humeur fortement altérée, avec besoin de soutien rapproché"
    ]
  },
  "soi_estime": {
    "M": [
      "Estime de soi préservée",
      "Estime de soi légèrement fragilisée",
      "Estime de soi fragile, avec besoin de valorisation",
      "Estime de soi faible, avec découragement fréquent",
      "Estime de soi très faible, avec retrait et manque d’assurance",
      "Estime de soi fortement altérée, nécessitant un accompagnement soutenu"
    ],
    "F": [
      "Estime de soi préservée",
      "Estime de soi légèrement fragilisée",
      "Estime de soi fragile, avec besoin de valorisation",
      "Estime de soi faible, avec découragement fréquent",
      "Estime de soi très faible, avec retrait et manque d’assurance",
      "Estime de soi fortement altérée, nécessitant un accompagnement soutenu"
    ]
  },
  "social_reseau": {
    "M": [
      "Réseau social présent et mobilisable",
      "Réseau social présent mais irrégulier",
      "Réseau social limité, avec besoin de coordination",
      "Réseau social faible, nécessitant relais par les professionnels",
      "Réseau social très faible, isolement important",
      "Réseau social absent, nécessitant une prise en charge complète"
    ],
    "F": [
      "Réseau social présent et mobilisable",
      "Réseau social présent mais irrégulier",
      "Réseau social limité, avec besoin de coordination",
      "Réseau social faible, nécessitant relais par les professionnels",
      "Réseau social très faible, isolement important",
      "Réseau social absent, nécessitant une prise en charge complète"
    ]
  },
  "social_participation": {
    "M": [
      "Participation sociale satisfaisante",
      "Participation sociale légèrement réduit",
      "Participation sociale réduit, avec retrait progressif",
      "Isolement important, avec peu d’activités",
      "Isolement très important, avec retrait marqué",
      "Isolement majeur, isolement quasi complet"
    ],
    "F": [
      "Participation sociale satisfaisante",
      "Participation sociale légèrement réduit",
      "Participation sociale réduit, avec retrait progressif",
      "Isolement important, avec peu d’activités",
      "Isolement très important, avec retrait marqué",
      "Isolement majeur, isolement quasi complet"
    ]
  },
  "social_aidant": {
    "M": [
      "Charge de l’aidant / Coordination sans difficulté majeure",
      "Charge de l’aidant légère avec ajustements ponctuels",
      "Charge de l’aidant présente, nécessitant coordination régulière",
      "Charge de l’aidant importante, avec besoin d’organiser des relais",
      "Charge de l’aidant très importante, avec risque d’épuisement",
      "Charge de l’aidant majeure, avec besoin de soutien intensif"
    ],
    "F": [
      "Charge de l’aidant / coordination sans difficulté majeure",
      "Charge de l’aidant légère, avec ajustements ponctuels",
      "Charge de l’aidant présente, nécessitant coordination régulière",
      "Charge de l’aidant importante, avec besoin d’organiser des relais",
      "Charge de l’aidant très importante, avec risque d’épuisement",
      "Charge de l’aidant majeure, avec besoin de soutien intensif"
    ]
  },
  "mob_transferts": {
    "M": [
      "Transferts réalisés de manière autonome",
      "Transferts possibles avec supervision",
      "Transferts nécessitant une aide ponctuelle",
      "Transferts nécessitant une aide régulière",
      "Transferts difficiles, avec aide importante",
      "Transferts non réalisables de manière autonome"
    ],
    "F": [
      "Transferts réalisés de manière autonome",
      "Transferts possibles avec supervision",
      "Transferts nécessitant une aide ponctuelle",
      "Transferts nécessitant une aide régulière",
      "Transferts difficiles, avec aide importante",
      "Transferts non réalisables de manière autonome"
    ]
  },
  "mob_marche": {
    "M": [
      "Déplacements possibles sans difficulté particulière",
      "Déplacements globalement stables, avec pauses occasionnelles",
      "Déplacements limités, avec besoin de supervision",
      "Déplacements difficiles, avec aide régulière",
      "Déplacements très limités, avec accompagnement rapproché",
      "Déplacements quasi impossibles, recours majoritaire au fauteuil"
    ],
    "F": [
      "Déplacements possibles sans difficulté particulière",
      "Déplacements globalement stables, avec pauses occasionnelles",
      "Déplacements limités, avec besoin de supervision",
      "Déplacements difficiles, avec aide régulière",
      "Déplacements très limités, avec accompagnement rapproché",
      "Déplacements quasi impossibles, recours majoritaire au fauteuil"
    ]
  },
  "mob_equilibre": {
    "M": [
      "Équilibre / stabilité satisfaisants",
      "Équilibre légèrement instable, avec prudence",
      "Équilibre instable, avec besoin de sécurisation",
      "Équilibre très instable, avec risque de déséquilibre",
      "Équilibre fortement compromis, avec encadrement rapproché",
      "Déséquilibre majeur, nécessitant assistance constante"
    ],
    "F": [
      "Équilibre / stabilité satisfaisants",
      "Équilibre légèrement instable, avec prudence",
      "Équilibre instable, avec besoin de sécurisation",
      "Équilibre très instable, avec risque de déséquilibre",
      "Équilibre fortement compromis, avec encadrement rapproché",
      "Déséquilibre majeur, nécessitant assistance constante"
    ]
  },
  "mob_escalier": {
    "M": [
      "Escaliers / franchissements possibles",
      "Escaliers possibles avec appui et prudence",
      "Escaliers possibles avec surveillance",
      "Escaliers difficiles, avec aide régulière",
      "Escaliers très difficiles, généralement évités",
      "Escaliers impossibles, nécessitant une alternative"
    ],
    "F": [
      "Escaliers / franchissements possibles",
      "Escaliers possibles avec appui et prudence",
      "Escaliers possibles avec surveillance",
      "Escaliers difficiles, avec aide régulière",
      "Escaliers très difficiles, généralement évités",
      "Escaliers impossibles, nécessitant une alternative"
    ]
  },
  "mob_aides": {
    "M": [
      "Besoin de moyens auxiliaires absent",
      "Besoin de moyens auxiliaires ponctuel",
      "Besoin de moyens auxiliaires présent lors des déplacements",
      "Besoin de moyens auxiliaires important, utilisation régulière",
      "Besoin de moyens auxiliaires très important, indispensable",
      "Besoin de moyens auxiliaires majeur, avec besoin d’assistance en plus"
    ],
    "F": [
      "Besoin de moyens auxiliaires absent",
      "Besoin de moyens auxiliaires ponctuel",
      "Besoin de moyens auxiliaires présent lors des déplacements",
      "Besoin de moyens auxiliaires important, utilisation régulière",
      "Besoin de moyens auxiliaires très important, indispensable",
      "Besoin de moyens auxiliaires majeur, avec besoin d’assistance en plus"
    ]
  },
  "mob_endurance": {
    "M": [
      "Tolérance à l’effort à la marche bonne",
      "Tolérance à l’effort à la marche légèrement diminuée",
      "Tolérance à l’effort à la marche diminuée, pauses nécessaires",
      "Tolérance à l’effort à la marche faible, endurance limité",
      "Tolérance à l’effort à la marche très faible, déplacement difficile",
      "Tolérance à l’effort à la marche quasi nulle, avec limitation majeure"
    ],
    "F": [
      "Tolérance à l’effort à la marche bonne",
      "Tolérance à l’effort à la marche légèrement diminuée",
      "Tolérance à l’effort à la marche diminuée, pauses nécessaires",
      "Tolérance à l’effort à la marche faible, endurance limité",
      "Tolérance à l’effort à la marche très faible, déplacement difficile",
      "Tolérance à l’effort à la marche quasi nulle, avec limitation majeure"
    ]
  },
  "energie_fatigue": {
    "M": [
      "Endurance sans élément marquant",
      "Endurance légèrement diminuée, avec pauses ponctuelles",
      "Endurance diminuée, nécessitant des temps de repos",
      "Endurance faible, avec fatigabilité rapide",
      "Endurance très faible, activités très limitées",
      "Fatigue majeure, besoin de repos quasi constant"
    ],
    "F": [
      "Endurance sans élément marquant",
      "Endurance légèrement diminuée, avec pauses ponctuelles",
      "Endurance diminuée, nécessitant des temps de repos",
      "Endurance faible, avec fatigabilité rapide",
      "Endurance très faible, activités très limitées",
      "Fatigue majeure, besoin de repos quasi constant"
    ]
  },
  "activites_quot": {
    "M": [
      "Activités quotidiennes gérées de manière autonome",
      "Activités quotidiennes globalement gérées, avec rappels ponctuels",
      "Activités quotidiennes nécessitant repères et soutien régulier",
      "Activités quotidiennes difficiles, avec besoin d’encadrement",
      "Activités quotidiennes très difficiles, prise en charge importante",
      "Activités quotidiennes non gérées de manière autonome"
    ],
    "F": [
      "Activités quotidiennes gérées de manière autonome",
      "Activités quotidiennes globalement gérées, avec rappels ponctuels",
      "Activités quotidiennes nécessitant repères et soutien régulier",
      "Activités quotidiennes difficiles, avec besoin d’encadrement",
      "Activités quotidiennes très difficiles, prise en charge importante",
      "Activités quotidiennes non gérées de manière autonome"
    ]
  },
  "gestion_taches": {
    "M": [
      "Gestion tâches simples (repères, routine) adéquate",
      "Gestion tâches simples (repères, routine) globalement correcte, avec guidance ponctuelle",
      "Gestion tâches simples (repères, routine) fluctuante, avec besoin de rappels",
      "Gestion tâches simples (repères, routine) limitée, avec accompagnement régulier",
      "Gestion tâches simples (repères, routine) très limitée, avec aide importante",
      "Gestion tâches simples (repères, routine) quasi impossible, dépendance élevée"
    ],
    "F": [
      "Gestion tâches simples (repères, routine) adéquate",
      "Gestion tâches simples (repères, routine) globalement correcte, avec guidance ponctuelle",
      "Gestion tâches simples (repères, routine) fluctuante, avec besoin de rappels",
      "Gestion tâches simples (repères, routine) limitée, avec accompagnement régulier",
      "Gestion tâches simples (repères, routine) très limitée, avec aide importante",
      "Gestion tâches simples (repères, routine) quasi impossible, dépendance élevée"
    ]
  },
  "alim_appetit": {
    "M": [
      "Prises alimentaires satisfaisants",
      "Prises alimentaires légèrement diminués",
      "Prises alimentaires diminués, avec encouragements nécessaires",
      "Prises alimentaires faibles, avec apports souvent insuffisants",
      "Prises alimentaires très faibles, avec refus fréquents",
      "Prises alimentaires quasi nuls, avec risque de dénutrition"
    ],
    "F": [
      "Prises alimentaires satisfaisants",
      "Prises alimentaires légèrement diminués",
      "Prises alimentaires diminués, avec encouragements nécessaires",
      "Prises alimentaires faibles, avec apports souvent insuffisants",
      "Prises alimentaires très faibles, avec refus fréquents",
      "Prises alimentaires quasi nuls, avec risque de dénutrition"
    ]
  },
  "alim_hydratation": {
    "M": [
      "Hydratation adéquate",
      "Hydratation à soutenir ponctuellement (rappels)",
      "Hydratation nécessitant encouragements réguliers",
      "Hydratation difficile, apports insuffisants fréquents",
      "Hydratation très difficile, avec suivi rapproché",
      "Deshydratation majeure, avec contrôle strict des apports"
    ],
    "F": [
      "Hydratation adéquate",
      "Hydratation à soutenir ponctuellement (rappels)",
      "Hydratation nécessitant encouragements réguliers",
      "Hydratation difficile, apports insuffisants fréquents",
      "Hydratation très difficile, avec suivi rapproché",
      "Deshydratation majeure, avec contrôle strict des apports"
    ]
  },
  "alim_deglutition": {
    "M": [
      "Déglutition sans difficulté repérée",
      "Déglutition à surveiller, toux occasionnelle",
      "Déglutition sensible, adaptations nécessaires",
      "Risque de fausse route important, consignes strictes au repas",
      "Risque de fausse route très important, textures/rythme à adapter systématiquement",
      "Risque de fausse route majeur, alimentation à sécuriser étroitement"
    ],
    "F": [
      "Déglutition sans difficulté repérée",
      "Déglutition à surveiller, toux occasionnelle",
      "Déglutition sensible, adaptations nécessaires",
      "Risque de fausse route important, consignes strictes au repas",
      "Risque de fausse route très important, textures/rythme à adapter systématiquement",
      "Risque de fausse route majeur, alimentation à sécuriser étroitement"
    ]
  },
  "alim_aide": {
    "M": [
      "Aide au repas non nécessaire",
      "Aide au repas légère (couper, installer)",
      "Aide au repas régulière, avec stimulation",
      "Aide au repas importante, avec assistance partielle",
      "Aide au repas très importante, avec assistance majeure",
      "Aide au repas complète, alimentation assurée par l’équipe"
    ],
    "F": [
      "Aide au repas non nécessaire",
      "Aide au repas légère (couper, installer)",
      "Aide au repas régulière, avec stimulation",
      "Aide au repas importante, avec assistance partielle",
      "Aide au repas très importante, avec assistance majeure",
      "Aide au repas complète, alimentation assurée par l’équipe"
    ]
  },
  "alim_regime": {
    "M": [
      "Régime alimentaire bien intégré",
      "Consignes alimentaires globalement respectés, avec rappels ponctuels",
      "Consignes alimentaires partiellement respectés, besoin de rappels",
      "Consignes alimentaires difficiles à suivre, écarts fréquents",
      "Consignes alimentaires très difficiles à suivre, adhésion faible",
      "Consignes alimentaires non suivis, nécessitant encadrement strict"
    ],
    "F": [
      "Régime bien intégrée",
      "Consignes alimentaires globalement respectés, avec rappels ponctuels",
      "Consignes alimentaires partiellement respectés, besoin de rappels",
      "Consignes alimentaires difficiles à suivre, écarts fréquents",
      "Consignes alimentaires très difficiles à suivre, adhésion faible",
      "Consignes alimentaires non suivis, nécessitant encadrement strict"
    ]
  },
  "alim_digestif": {
    "M": [
      "Inconfort digestif occasionnel",
      "Inconfort digestif régulier, avec besoin d’adaptations",
      "Inconfort digestif fréquent, avec un impact sur l’alimentation",
      "Inconfort digestif non rapporté",
      "Inconfort digestif très fréquent, avec gêne importante",
      "Inconfort digestif majeur, nécessitant prise en charge rapprochée"
    ],
    "F": [
      "Inconfort digestif occasionnel",
      "Inconfort digestif régulier, avec besoin d’adaptations",
      "Inconfort digestif fréquent, avec un impact sur l’alimentation",
      "Inconfort digestif non rapporté",
      "Inconfort digestif très fréquent, avec gêne importante",
      "Inconfort digestif majeur, nécessitant prise en charge rapprochée"
    ]
  },
  "sommeil_qualite": {
    "M": [
      "Qualité du sommeil satisfaisante",
      "Qualité du sommeil globalement correcte, avec endormissement parfois prolongé",
      "Qualité du sommeil fluctuante, avec sommeil peu réparateur",
      "Qualité du sommeil altérée, avec fatigue au réveil",
      "Qualité du sommeil très altérée, avec un impact important",
      "Qualité du sommeil fortement altérée, avec besoin d’un soutien rapproché"
    ],
    "F": [
      "Qualité du sommeil satisfaisante",
      "Qualité du sommeil globalement correcte, avec endormissement parfois prolongé",
      "Qualité du sommeil fluctuante, avec sommeil peu réparateur",
      "Qualité du sommeil altérée, avec fatigue au réveil",
      "Qualité du sommeil très altérée, avec un impact important",
      "Qualité du sommeil fortement altérée, avec besoin d’un soutien rapproché"
    ]
  },
  "sommeil_reveils": {
    "M": [
      "Réveils nocturnes non signalés",
      "Réveils nocturnes occasionnels",
      "Réveils nocturnes réguliers, avec besoin de réassurance",
      "Réveils nocturnes fréquents, avec perturbation du repos",
      "Réveils nocturnes très fréquents, avec un impact important",
      "Réveils nocturnes majeurs, nécessitant surveillance rapprochée"
    ],
    "F": [
      "Réveils nocturnes non signalés",
      "Réveils nocturnes occasionnels",
      "Réveils nocturnes réguliers, avec besoin de réassurance",
      "Réveils nocturnes fréquents, avec perturbation du repos",
      "Réveils nocturnes très fréquents, avec un impact important",
      "Réveils nocturnes majeurs, nécessitant surveillance rapprochée"
    ]
  },
  "sommeil_sieste": {
    "M": [
      "Somnolence diurne non marquée",
      "Somnolence diurne occasionnelle",
      "Somnolence diurne régulière, avec baisse d’énergie",
      "Somnolence diurne fréquente, avec participation réduite",
      "Somnolence diurne très fréquente, avec un impact important",
      "Somnolence diurne majeure, vigilance très réduite"
    ],
    "F": [
      "Somnolence diurne non marquée",
      "Somnolence diurne occasionnelle",
      "Somnolence diurne régulière, avec baisse d’énergie",
      "Somnolence diurne fréquente, avec participation réduite",
      "Somnolence diurne très fréquente, avec un impact important",
      "Somnolence diurne majeure, vigilance très réduite"
    ]
  },
  "avq_toilette": {
    "M": [
      "Toilette réalisées de manière autonome",
      "Toilette globalement autonomes, avec supervision",
      "Toilette nécessitant une aide partielle",
      "Toilette nécessitant une aide régulière",
      "Toilette très difficiles, avec prise en charge importante",
      "Toilette non réalisable de manière autonome, prise en charge complète"
    ],
    "F": [
      "Toilette réalisées de manière autonome",
      "Toilette globalement autonomes, avec supervision",
      "Toilette nécessitant une aide partielle",
      "Toilette nécessitant une aide régulière",
      "Toilette très difficiles, avec prise en charge importante",
      "Toilette non réalisable de manière autonome, prise en charge complète"
    ]
  },
  "avq_habillage": {
    "M": [
      "Habillage réalisé de manière autonome",
      "Habillage globalement autonome, avec aide ponctuelle",
      "Habillage nécessitant une aide régulière (choix, mise en place)",
      "Habillage difficile, avec aide importante",
      "Habillage très difficile, majoritairement réalisé par l’équipe",
      "Habillage entièrement réalisé par l’équipe"
    ],
    "F": [
      "Habillage réalisé de manière autonome",
      "Habillage globalement autonome, avec aide ponctuelle",
      "Habillage nécessitant une aide régulière (choix, mise en place)",
      "Habillage difficile, avec aide importante",
      "Habillage très difficile, majoritairement réalisé par l’équipe",
      "Habillage entièrement réalisé par l’équipe"
    ]
  },
  "avq_transferts_wc": {
    "M": [
      "Aller aux WC géré de manière autonome",
      "Aller aux WC globalement autonome, avec supervision",
      "Aller aux WC nécessitant une aide ponctuelle",
      "Aller aux WC nécessitant une aide régulière",
      "Aller aux WC très difficile, avec prise en charge importante",
      "Aller aux WC pris en charge par l’équipe"
    ],
    "F": [
      "Aller aux WC géré de manière autonome",
      "Aller aux WC globalement autonome, avec supervision",
      "Aller aux WC nécessitant une aide ponctuelle",
      "Aller aux WC nécessitant une aide régulière",
      "Aller aux WC très difficile, avec prise en charge importante",
      "Aller aux WC pris en charge par l’équipe"
    ]
  },
  "avq_soins": {
    "M": [
      "Soins corporels spécifiques (peau, ongles) sans besoin particulier",
      "Soins corporels spécifiques (peau, ongles) ponctuels, selon observation",
      "Soins corporels spécifiques (peau, ongles) réguliers, avec surveillance",
      "Soins corporels spécifiques (peau, ongles) fréquents, avec mesures renforcées",
      "Soins corporels spécifiques (peau, ongles) très fréquents, avec suivi rapproché",
      "Soins corporels spécifiques (peau, ongles) constants, avec prise en charge complète"
    ],
    "F": [
      "Soins corporels spécifiques (peau, ongles) sans besoin particulier",
      "Soins corporels spécifiques (peau, ongles) ponctuels, selon observation",
      "Soins corporels spécifiques (peau, ongles) réguliers, avec surveillance",
      "Soins corporels spécifiques (peau, ongles) fréquents, avec mesures renforcées",
      "Soins corporels spécifiques (peau, ongles) très fréquents, avec suivi rapproché",
      "Soins corporels spécifiques (peau, ongles) constants, avec prise en charge complète"
    ]
  },
  "resp_dyspnee": {
    "M": [
      "Essoufflement non signalé",
      "Essoufflement discret à l’effort",
      "Essoufflement présent à l’effort, avec pauses nécessaires",
      "Essoufflement fréquent, limitant les déplacements",
      "Essoufflement important, avec gêne marquée",
      "Essoufflement majeur, avec gêne quasi constante"
    ],
    "F": [
      "Essoufflement non signalé",
      "Essoufflement discret à l’effort",
      "Essoufflement présent à l’effort, avec pauses nécessaires",
      "Essoufflement fréquent, limitant les déplacements",
      "Essoufflement important, avec gêne marquée",
      "Essoufflement majeur, avec gêne quasi constante"
    ]
  },
  "resp_toux": {
    "M": [
      "Toux / encombrement non signalé",
      "Toux / encombrement léger, occasionnel",
      "Toux / encombrement présent, avec gêne régulière",
      "Toux / encombrement important, avec expectorations et besoin d’aide",
      "Toux / encombrement très important, avec besoin de désencombrement régulier",
      "Toux / encombrement majeur, avec surveillance rapprochée"
    ],
    "F": [
      "Toux / encombrement non signalé",
      "Toux / encombrement léger, occasionnel",
      "Toux / encombrement présent, avec gêne régulière",
      "Toux / encombrement important, avec expectorations et besoin d’aide",
      "Toux / encombrement très important, avec besoin de désencombrement régulier",
      "Toux / encombrement majeur, avec surveillance rapprochée"
    ]
  },
  "resp_oxygeno": {
    "M": [
      "Besoin d’oxygène non nécessaire",
      "Besoin d’oxygène ponctuel (contrôles)",
      "Besoin d’oxygène régulier, avec contrôles rapprochés",
      "Besoin d’oxygène important, avec surveillance étroite",
      "Besoin d’oxygène très important, avec besoin d’ajustements",
      "Besoin d’oxygène majeur, avec prise en charge continue"
    ],
    "F": [
      "Besoin d’oxygène non nécessaire",
      "Besoin d’oxygène ponctuel (contrôles)",
      "Besoin d’oxygène régulier, avec contrôles rapprochés",
      "Besoin d’oxygène important, avec surveillance étroite",
      "Besoin d’oxygène très important, avec besoin d’ajustements",
      "Besoin d’oxygène majeur, avec prise en charge continue"
    ]
  },
  "elim_urinaire": {
    "M": [
      "Élimination urinaire (continence) satisfaisante",
      "Élimination urinaire (continence) avec pertes occasionnels",
      "Élimination urinaire (continence) fluctuante, avec fuites régulières",
      "Élimination urinaire (continence) difficile, protections nécessaires",
      "Élimination urinaire (continence) très difficile, avec changes fréquents",
      "Élimination urinaire (continence) fortement compromise, prise en charge complète"
    ],
    "F": [
      "Élimination urinaire (continence) satisfaisante",
      "Élimination urinaire (continence) avec pertes occasionnels",
      "Élimination urinaire (continence) fluctuante, avec fuites régulières",
      "Élimination urinaire (continence) difficile, protections nécessaires",
      "Élimination urinaire (continence) très difficile, avec changes fréquents",
      "Élimination urinaire (continence) fortement compromise, prise en charge complète"
    ]
  },
  "elim_transit": {
    "M": [
      "Transit intestinal sans difficulté particulière",
      "Légère tendance à la constipation",
      "Constipation présent, avec mesures hygiéno-diététiques/soins à soutenir",
      "Constipation marqué, avec surveillance et interventions régulières",
      "Constipation très marqué, avec besoin de prise en charge rapprochée",
      "Constipation majeur, avec interventions constantes"
    ],
    "F": [
      "Transit intestinal sans difficulté particulière",
      "Légère tendance à la constipation",
      "Constipation présent, avec mesures hygiéno-diététiques/soins à soutenir",
      "Constipation marqué, avec surveillance et interventions régulières",
      "Constipation très marqué, avec besoin de prise en charge rapprochée",
      "Constipation majeur, avec interventions constantes"
    ]
  },
  "elim_surv": {
    "M": [
      "Surveillance (diurèse, selles) non nécessaire",
      "Surveillance (diurèse, selles) ponctuelle, selon évolution",
      "Surveillance (diurèse, selles) régulière",
      "Surveillance (diurèse, selles) rapprochée, avec traçabilité",
      "Surveillance (diurèse, selles) très rapprochée, avec suivi strict",
      "Surveillance (diurèse, selles) constante, avec contrôle étroit"
    ],
    "F": [
      "Surveillance (diurèse, selles) non nécessaire",
      "Surveillance (diurèse, selles) ponctuelle, selon évolution",
      "Surveillance (diurèse, selles) régulière",
      "Surveillance (diurèse, selles) rapprochée, avec traçabilité",
      "Surveillance (diurèse, selles) très rapprochée, avec suivi strict",
      "Surveillance (diurèse, selles) constante, avec contrôle étroit"
    ]
  },
  "elim_aide": {
    "M": [
      "Aide nécessaire (protections, changes) non requise",
      "Aide nécessaire (protections, changes) ponctuelle",
      "Aide nécessaire (protections, changes) régulière",
      "Aide nécessaire (protections, changes) importante, avec changes fréquents",
      "Aide nécessaire (protections, changes) très importante, avec prise en charge majeure",
      "Aide nécessaire (protections, changes) complète, assurée par l’équipe"
    ],
    "F": [
      "Aide nécessaire (protections, changes) non requise",
      "Aide nécessaire (protections, changes) ponctuelle",
      "Aide nécessaire (protections, changes) régulière",
      "Aide nécessaire (protections, changes) importante, avec changes fréquents",
      "Aide nécessaire (protections, changes) très importante, avec prise en charge majeure",
      "Aide nécessaire (protections, changes) complète, assurée par l’équipe"
    ]
  }
}

  </script>

  <script id="rules-json" type="application/json">
{}
  </script>

  <!-- ========================= APP LOGIC ========================= -->
  <script>
  // Global UI state (shared across functions)
  var stateValues = {};
  var stateEnabled = {};
  var stateTwoPerson = {};

    (function () {
      function $(id) { return document.getElementById(id); }
      function setStatus(msg) { $("status").textContent = msg || ""; }
      function setVisibleCount(n) { $("visibleCount").textContent = String(n); }

      // Robust JSON reader: supports /* */ and // comments + trailing commas
      function readJson(scriptId) {
        var el = $(scriptId);
        if (!el) throw new Error("Missing JSON script tag: " + scriptId);

        var txt = el.textContent || "";
        txt = txt.replace(/^\uFEFF/, "");                 // BOM
        txt = txt.replace(/\/\*[\s\S]*?\*\//g, "");       // /* ... */
        txt = txt.replace(/^\s*\/\/.*$/gm, "");           // // ...
        txt = txt.replace(/,\s*([}\]])/g, "$1");          // trailing commas

        return JSON.parse(txt);
      }
      function readJsonArray(scriptId) {
        var v = readJson(scriptId);
        if (!Array.isArray(v)) throw new Error(scriptId + " must be an array");
        return v;
      }

      function normalizeDomain(s) {
        if (!s) return "";
        return String(s).replace(/\u2019/g, "'").replace(/\s+/g, " ").trim();
      }
      function cap(s) {
        if (!s) return s;
        return s.charAt(0).toUpperCase() + s.slice(1);
      }

      

      function lowerFirst(s) {
        s = String(s || "").trim();
        if (!s) return s;
        return s.charAt(0).toLowerCase() + s.slice(1);
      }

function shouldInclude(rules, paramId, level) {
        var rule = rules ? rules[paramId] : null;
        if (!rule) return true;
        if (typeof rule.include_if_level_at_least === "number") return level >= rule.include_if_level_at_least;
        return true;
      }

      function inferSeverity(levels) {
        if (!levels || !levels.length) return { avg: 0, max: 0, band: "low" };
        var sum = 0, max = 0;
        for (var i = 0; i < levels.length; i++) {
          sum += levels[i];
          if (levels[i] > max) max = levels[i];
        }
        var avg = sum / levels.length;
        var score = (avg * 0.55) + (max * 0.45);
        var band = "low";
        if (score >= 3.8) band = "high";
        else if (score >= 2.2) band = "moderate";
        return { avg: avg, max: max, band: band };
      }

      // -------- Natural intros (no "éléments suivants") --------
      function domainIntro(domain, gender) {
        // Domain lead-in used ONLY when generating multiple domains at once.
        // It must NOT assume the first clause is a "symptom noun phrase".
        // Keep it light and neutral to avoid awkward grammar.
        var dom = normalizeDomain(domain);

        function lowerFirst(s) {
          s = String(s || "").trim();
          if (!s) return s;
          return s.charAt(0).toLowerCase() + s.slice(1);
        }

        // IMPORTANT: for Douleur we avoid repeating "douleur" in the intro.
        if (dom === normalizeDomain("Douleur")) {
          return "Sur le plan douloureux, ";
        }

        var map = {};
        map[normalizeDomain("Perception / cognition (attention, orientation, sensations)")] =
          "Sur le plan cognitif, ";
        map[normalizeDomain("Comportement face à la santé / Apprendre (sensibilisation à la santé, bien-être-confort)")] =
          "Concernant l’adhésion et le confort, ";
        map[normalizeDomain("Principes de vie (valeurs, croyances, autonomie)")] =
          "Sur le plan de l’autonomie et de la motivation, ";
        map[normalizeDomain("Communiquer")] =
          "Sur le plan de la communication, ";
        map[normalizeDomain("Sécurité / protection (hygiène, état cutané, risque de chute, infection, circulation sanguine)")] =
          "Sur le plan de la sécurité et de la prévention, ";
        map[normalizeDomain("Se mobiliser/motricité")] =
          "Concernant la mobilisation, ";
        map[normalizeDomain("Se laver / S'habiller / Maintenir l'apparence")] =
          "Concernant l’hygiène et l’habillement, ";
        map[normalizeDomain("Manger / Boire")] =
          "Concernant l’alimentation et l’hydratation, ";
        map[normalizeDomain("Éliminer (urines, selles)")] =
          "Concernant l’élimination, ";
        map[normalizeDomain("Se reposer / Dormir")] =
          "Concernant le repos et le sommeil, ";
        map[normalizeDomain("Entretenir des relations sociales")] =
          "Concernant les relations sociales, ";
        map[normalizeDomain("Activités / Loisirs")] =
          "Concernant les activités, ";
        map[normalizeDomain("Respirer")] =
          "Sur le plan respiratoire, ";
        map[normalizeDomain("Température")] =
          "Sur le plan thermique, ";
        map[normalizeDomain("Peau / Téguments")] =
          "Sur le plan cutané, ";
        map[normalizeDomain("Traitements / Médication")] =
          "Concernant les traitements, ";

        if (map[dom]) return map[dom];

        // Default: reuse the domain label itself, lowered to sit mid-sentence.
        var d = String(domain || "").replace(/\s*\([^\)]*\)\s*/g, " ").replace(/\s+/g, " ").trim();
        if (!d) return "";
        return "Au niveau de " + lowerFirst(d) + ", ";
      }

      // -------- One action sentence per domain (no repetitive boilerplate per slider) --------
      function domainActionSentence(domain, gender, sev) {
        // Disabled: generic action sentence often repeats and breaks narrative flow.
        // Paragraphs should be driven by the selected slider clauses only.
        return "";
      }

      // -------- Slider phrase -> CLAUSE (not full sentence), PoC style --------
      function getClause(phrases, parameters, paramId, gender, level, twoPerson) {
        var def = parameters && parameters[paramId];
        var label = (def && def.label) ? def.label : paramId;
        var labelShort = String(label).replace(/\s*\([^\)]*\)\s*/g, " ").replace(/\s+/g, " ").trim();
        var dom = def && def.domain ? def.domain : "";

        var lvl = Math.max(0, Math.min(5, Number(level) || 0));

        var raw = "";
        if (phrases && phrases[paramId] && phrases[paramId][gender]) {
          var list = phrases[paramId][gender];
          if (Array.isArray(list) && list.length) {
            var idx = Math.min(lvl, list.length - 1);
            raw = String(list[idx] || "").trim();
          }
        }

        // If raw exists, adapt it into a clause
        if (raw) {
          var r = raw.replace(/[.]+$/g, "").trim();

          // Remove any leading "label :" if it exists (older templates)
          var lowLabel = label.toLowerCase();
          if (r.toLowerCase().indexOf(lowLabel + " :") === 0) {
            r = r.slice((lowLabel + " :").length).trim();
          }

          // If the clause does not already mention the target (and it is not pain), append a natural reference.
          var isPain = (dom === "Douleur") || /\bdouleur\b/i.test(label);
          var lowShort = labelShort.toLowerCase();
          if (!isPain && lowShort && r.toLowerCase().indexOf(lowShort) === -1) {
            r = r.replace(/\s+$/g, "") + " concernant " + lowShort;
          }

          // Fix for Douleur repetition: ensure clause is "des douleurs ..." and intro does not mention douleur
          if (normalizeDomain(dom) === normalizeDomain("Douleur")) {
            var low = r.toLowerCase();
            if (low.startsWith("douleurs ")) r = "des " + r;
            else if (low.startsWith("douleur ")) r = "une " + r;
          }

          if (twoPerson) r += ", avec l’aide de deux personnes";
          return r;
        }

        // Fallback clause (longer / clearer)
        var fb = [
          "aucune difficulté notable à ce stade",
          "une difficulté légère, avec impact limité sur le quotidien",
          "une difficulté modérée, nécessitant une surveillance et des ajustements ponctuels",
          "une difficulté importante, avec besoin d’aide régulière",
          "une difficulté très importante, avec un impact significatif sur l’autonomie",
          "une difficulté majeure, avec dépendance élevée et besoins constants"
        ];
        // Use label in fallback to stay understandable
        var out = fb[lvl];

        // Do not display the slider label/value; keep it natural.
        var isPain = (dom === "Douleur") || /\bdouleur\b/i.test(label);
        if (!isPain) out += " concernant " + labelShort.toLowerCase();

        if (twoPerson) out += ", avec l’aide de deux personnes";
        return out;
      }

      
      function hashString(s) {
        s = String(s || "");
        var h = 0;
        for (var i = 0; i < s.length; i++) {
          h = ((h << 5) - h) + s.charCodeAt(i);
          h |= 0;
        }
        return h;
      }

      function pickConnector(domain, salt) {
        var connectors = [
          "Par ailleurs",
          "En complément",
          "De plus",
          "Dans la continuité",
          "Au besoin"
        ];
        var seed = Math.abs(hashString(domain) + (salt || 0));
        return connectors[seed % connectors.length];
      }

      function chainClausesNoIntro(domain, clauses) {
        if (!clauses || !clauses.length) return "";
        if (clauses.length === 1) return cap(clauses[0]) + ".";
        if (clauses.length === 2) return cap(clauses[0]) + ", " + lowerFirst(clauses[1]) + ".";

        if (clauses.length === 3) {
          return cap(clauses[0]) + ", " + lowerFirst(clauses[1]) + "; " + lowerFirst(clauses[2]) + ".";
        }

        // 4+ : split into 2–3 sentences for flow
        var out = cap(clauses[0]) + ", " + lowerFirst(clauses[1]) + ".";
        var c2 = pickConnector(domain, clauses.length);
        out += " " + c2 + ", " + lowerFirst(clauses[2]) + ", " + lowerFirst(clauses[3]) + ".";

        if (clauses.length > 4) {
          var rest = [];
          for (var i = 4; i < clauses.length; i++) rest.push(lowerFirst(clauses[i]));
          var c3 = pickConnector(domain + "|tail", clauses.length);
          out += " " + c3 + ", " + rest.join(", ") + ".";
        }
        return out;
      }

      function chainClausesWithIntro(domain, intro, clauses) {
        if (!clauses || !clauses.length) return "";
        var c = clauses.slice();

        // Intro is already contextual; keep the first clause as a continuation.
        if (c.length === 1) {
          return cap(intro + " " + lowerFirst(c[0]) + ".");
        }
        if (c.length === 2) {
          return cap(intro + " " + lowerFirst(c[0]) + ", " + lowerFirst(c[1]) + ".");
        }
        if (c.length === 3) {
          return cap(intro + " " + lowerFirst(c[0]) + ", " + lowerFirst(c[1]) + "; " + lowerFirst(c[2]) + ".");
        }

        // 4+
        var out = intro + " " + lowerFirst(c[0]) + ", " + lowerFirst(c[1]) + ".";
        var c2 = pickConnector(domain, c.length);
        out += " " + c2 + ", " + lowerFirst(c[2]) + ", " + lowerFirst(c[3]) + ".";
        if (c.length > 4) {
          var rest = [];
          for (var i = 4; i < c.length; i++) rest.push(lowerFirst(c[i]));
          var c3 = pickConnector(domain + "|tail", c.length);
          out += " " + c3 + ", " + rest.join(", ") + ".";
        }
        return cap(out);
      }

      function domainMonitoringSentence(domain, clauses, sev) {
        if (!sev || !sev.band) return "";
        var band = sev.band;
        if (band === "low") return "";

        // Keep this as a light optional ending (only when it really fits)
        if (band === "moderate" && (!clauses || clauses.length < 2)) return "";

        var d = normalizeDomain(domain || "");
        var textAll = (clauses || []).join(" ").toLowerCase();

        var hasPain = (d.indexOf("douleur") !== -1) || /\bdouleur\b/.test(textAll);
        var hasMobility = /transfert|marche|déplacement|deplacement|équilibre|equilibre|chute|mobil/.test(textAll) ||
                          /mobil|motric/.test(d);
        var hasWc = /\bwc\b|toilette|toilettes|continence|urines?|miction|selles|transit/.test(textAll);

        if (hasPain) {
          return "Surveillance de la douleur et de l’effet des mesures mises en place, avec réévaluation selon l’évolution.";
        }
        if (hasMobility) {
          return "Sécurisation et prévention des chutes maintenues, avec adaptation de l’accompagnement selon la tolérance.";
        }
        if (hasWc) {
          return "Surveillance de l'état cutanée et hydratation de la peau.";
        }
        return "";
      }

      function buildDomainParagraph(domain, clauses, gender, sev, includeIntro) {
        if (!clauses || !clauses.length) return "";

        // Default: includeIntro unless explicitly disabled
        if (includeIntro === undefined) includeIntro = true;

        // Clean clauses
        var cleaned = [];
        for (var i = 0; i < clauses.length; i++) {
          var s = String(clauses[i] || "").trim();
          if (!s) continue;

          // Remove trailing dots; we control punctuation here
          s = s.replace(/[.]+$/g, "").trim();

          cleaned.push(s);
        }
        if (!cleaned.length) return "";

        // Single-domain output: no intro, slightly more narrative chaining.
        if (!includeIntro) {
          var paragraph = chainClausesNoIntro(domain, cleaned);
          var monitor = domainMonitoringSentence(domain, cleaned, sev);
          if (monitor) paragraph += " " + monitor;
          return cap(paragraph.trim());
        }

        // Multi-domain output: add a light intro and chain clauses without awkward grammar assumptions.
        var intro = domainIntro(domain, gender);
        var paragraph2 = chainClausesWithIntro(domain, intro, cleaned);

        var monitor2 = domainMonitoringSentence(domain, cleaned, sev);
        if (monitor2) paragraph2 += " " + monitor2;

        return cap(String(paragraph2 || "").trim());
      }

      function generateTextNatural(stateForGen, data, options) {
        var gender = stateForGen.gender || "M";
        var selectedDomain = options.selectedDomain || "";

        var byDomain = {};
        var levelByDomain = {};

        for (var pid in stateForGen) {
          if (!stateForGen.hasOwnProperty(pid)) continue;
          if (pid === "gender") continue;

          var lvl = stateForGen[pid];
          if (typeof lvl !== "number") continue;

          var def = data.parameters[pid];
          if (!def || !def.domain) continue;

          if (!shouldInclude(data.rules, pid, lvl)) continue;

          var clause = getClause(data.phrases, data.parameters, pid, gender, lvl, options.twoPerson && options.twoPerson[pid]);
          if (!clause) continue;

          var dom = def.domain;
          if (!byDomain[dom]) byDomain[dom] = [];
          if (!levelByDomain[dom]) levelByDomain[dom] = [];
          byDomain[dom].push(clause);
          levelByDomain[dom].push(lvl);
        }

        var domainOrder = selectedDomain ? [selectedDomain] : data.domains.slice();
        var paragraphs = [];

        for (var i = 0; i < domainOrder.length; i++) {
          var dom = domainOrder[i];
          var items = byDomain[dom] || [];
          if (!items.length) continue;

          var sev = inferSeverity(levelByDomain[dom] || []);
          var p = buildDomainParagraph(dom, items, gender, sev, !selectedDomain);
          paragraphs.push(p.trim());
        }

        return paragraphs.join("\n\n");
      }

      var visibleParamIds = [];
      var selectedDomain = "";

      function buildDomainSelect(domains, onChange) {
        var select = $("domainSelect");
        select.innerHTML = "";

        var optAll = document.createElement("option");
        optAll.value = "";
        optAll.textContent = "— Tous les domaines —";
        select.appendChild(optAll);

        for (var i = 0; i < domains.length; i++) {
          var opt = document.createElement("option");
          opt.value = domains[i];
          opt.textContent = domains[i];
          select.appendChild(opt);
        }

        select.value = "";
        select.addEventListener("change", function () { onChange(select.value); });
      }

      function applyTheme(theme) {
        document.documentElement.setAttribute("data-theme", theme);
        localStorage.setItem("agn_theme", theme);
        $("themeLabel").textContent = (theme === "dark") ? "Mode clair" : "Mode sombre";
      }

      function renderControls(parameters, phrases, stateValues, stateEnabled, domain) {
        var controls = $("controls");
        controls.innerHTML = "";
        visibleParamIds = [];

        var domNorm = normalizeDomain(domain);
        function currentGender() { return stateValues.gender || "M"; }

        var visibleRanges = 0;
        var keys = Object.keys(parameters || {});
        for (var idx = 0; idx < keys.length; idx++) {
          var paramId = keys[idx];
          var def = parameters[paramId];
          if (!def || typeof def !== "object") continue;

          var isGender = (paramId === "gender");
          if (!isGender && domNorm) {
            var defDom = normalizeDomain(def.domain || "");
            if (defDom !== domNorm) continue;
          }

          if (def.type === "radio") {
            var wrapper = document.createElement("div");
            wrapper.className = "control";

            var label = document.createElement("label");
            label.textContent = def.label || paramId;
            wrapper.appendChild(label);

            var row = document.createElement("div");
            row.className = "radio-row";

            for (var r = 0; r < def.values.length; r++) {
              var v = def.values[r];

              var lab = document.createElement("label");
              var input = document.createElement("input");
              input.type = "radio";
              input.name = paramId;
              input.value = v;
              input.checked = (v === stateValues[paramId]);

              input.addEventListener("change", (function (pid, val) {
                return function () {
                  stateValues[pid] = val;

                  // refresh helper texts (gender changed)
                  var inputs = controls.querySelectorAll('input[type="range"]');
                  for (var i = 0; i < inputs.length; i++) {
                    var p = inputs[i].dataset.paramId;
                    var lvl = Number(inputs[i].value);
                    var defp = parameters[p];
                    var domp = defp && defp.domain ? defp.domain : "";
                    var txt = getClause(phrases, parameters, p, currentGender(), lvl, stateTwoPerson[p] === true);
                    if (inputs[i]._valueEl) inputs[i]._valueEl.textContent = lvl + " – " + txt;
                  }
                };
              })(paramId, v));

              var display = (def.display && def.display[v]) ? def.display[v] : v;
              lab.appendChild(input);
              lab.appendChild(document.createTextNode(" " + display));
              row.appendChild(lab);
            }

            wrapper.appendChild(row);
            controls.appendChild(wrapper);
            continue;
          }

          if (def.type === "range") {
            visibleParamIds.push(paramId);
            visibleRanges++;

            var block = document.createElement("div");
            block.className = "range-block";

            var head = document.createElement("div");
            head.className = "range-head";

            var titleWrap = document.createElement("div");
            titleWrap.className = "range-title";

            var enable = document.createElement("input");
            enable.type = "checkbox";
            enable.checked = (stateEnabled[paramId] !== false);
            enable.title = "Inclure/exclure ce paramètre";

            var title = document.createElement("span");
            title.textContent = def.label || paramId;

            titleWrap.appendChild(enable);
            titleWrap.appendChild(title);

            var flags = document.createElement("div");
            flags.className = "range-flags";

            var twoLab = document.createElement("label");
            twoLab.className = "mini-flag";
            twoLab.title = "Aide / intervention à deux personnes";
            var twoCb = document.createElement("input");
            twoCb.type = "checkbox";
            twoCb.checked = (stateTwoPerson[paramId] === true);
            twoLab.appendChild(twoCb);
            twoLab.appendChild(document.createTextNode("2 pers."));
            flags.appendChild(twoLab);

            head.appendChild(titleWrap);
            head.appendChild(flags);
            block.appendChild(head);

            var rangeRow = document.createElement("div");
            rangeRow.className = "range-row";

            var inputRange = document.createElement("input");
            inputRange.type = "range";
            inputRange.min = def.min;
            inputRange.max = def.max;
            inputRange.value = stateValues[paramId];
            inputRange.dataset.paramId = paramId;

            var value = document.createElement("div");
            value.className = "value";
            inputRange._valueEl = value;

            function updateFromInput(inputEl) {
              var pid = inputEl.dataset.paramId;
              var lvl = Number(inputEl.value);
              stateValues[pid] = lvl;

              var isTwo = (stateTwoPerson[pid] === true);
              var txt = getClause(phrases, parameters, pid, currentGender(), lvl, isTwo);
              if (inputEl._valueEl) inputEl._valueEl.textContent = lvl + " – " + txt + (isTwo ? " (2 pers.)" : "");
            }

            inputRange.addEventListener("input", function () { updateFromInput(this); });
            updateFromInput(inputRange);

            function applyEnabledUI(pid) {
              var enabled = (stateEnabled[pid] !== false);
              inputRange.disabled = !enabled;
              block.classList.toggle("is-disabled", !enabled);
              if (!enabled && inputRange._valueEl) {
                var lvl = Number(inputRange.value);
                var txt = getClause(phrases, parameters, pid, currentGender(), lvl, stateTwoPerson[pid] === true);
                inputRange._valueEl.textContent = lvl + " – " + txt + " (désactivé)";
              } else {
                updateFromInput(inputRange);
              }
            }

            enable.addEventListener("change", (function(pid){
              return function(){
                stateEnabled[pid] = this.checked;
                applyEnabledUI(pid);
              };
            })(paramId));

            twoCb.addEventListener("change", (function(pid){
              return function(){
                stateTwoPerson[pid] = this.checked;
                updateFromInput(inputRange);
              };
            })(paramId));

            // extend applyEnabledUI to also disable the 2-pers checkbox when slider is disabled
            var _applyEnabledUI = applyEnabledUI;
            applyEnabledUI = function(pid){
              _applyEnabledUI(pid);
              var enabled = (stateEnabled[pid] !== false);
              if (pid === paramId) twoCb.disabled = !enabled;
            };

            applyEnabledUI(paramId);

            rangeRow.appendChild(inputRange);
            rangeRow.appendChild(value);
            block.appendChild(rangeRow);

            controls.appendChild(block);
          }
        }

        setVisibleCount(visibleRanges);
      }

      async function copyToClipboard(text, textareaFallback) {
        try {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(text);
            return true;
          }
        } catch (e) { /* fallback */ }

        try {
          textareaFallback.focus();
          textareaFallback.select();
          var ok = !!document.execCommand("copy");
          try {
            var len = (textareaFallback.value || "").length;
            textareaFallback.setSelectionRange(len, len);
          } catch (eSel) { /* ignore */ }
          return ok;
} catch (e2) {
          return false;
        }
      }

      function main() {
        try {
          setStatus("Chargement…");

          var savedTheme = localStorage.getItem("agn_theme") || "dark";
          applyTheme(savedTheme);
          $("themeToggle").addEventListener("click", function () {
            var current = document.documentElement.getAttribute("data-theme") || "light";
            applyTheme(current === "dark" ? "light" : "dark");
          });

          // Append OFF by default (persisted)
          var appendSaved = localStorage.getItem("agn_append");
          $("appendMode").checked = (appendSaved === "1");
          $("appendMode").addEventListener("change", function(){
            localStorage.setItem("agn_append", this.checked ? "1" : "0");
          });

          var domains = readJsonArray("domains-json");
          var parameters = readJson("parameters-json");
          var phrases = readJson("phrases-json");
          var rules = readJson("rules-json");

          var data = { domains: domains, parameters: parameters, phrases: phrases, rules: rules };

          stateValues = {};
          stateEnabled = {};
          stateTwoPerson = {};

          var pkeys = Object.keys(parameters || {});
          for (var i = 0; i < pkeys.length; i++) {
            var k = pkeys[i];
            stateValues[k] = parameters[k].default;
            if (parameters[k].type === "range") {
              stateEnabled[k] = true;
              stateTwoPerson[k] = false;
            }
          }

          var previewEl = $("preview");
          var noteBox = $("noteBox");

          function stateForGeneration() {
            var st = { gender: stateValues.gender };
            for (var i = 0; i < visibleParamIds.length; i++) {
              var pid = visibleParamIds[i];
              if (stateEnabled[pid] === false) continue;
              st[pid] = stateValues[pid];
            }
            return st;
          }

          function doPreview() {
            var txt = generateTextNatural(
              stateForGeneration(),
              data,
              { selectedDomain: selectedDomain, twoPerson: stateTwoPerson }
            );

            previewEl.textContent = txt;

            var append = $("appendMode").checked;
            if (!append) {
              noteBox.value = txt;
            } else {
              var base = (noteBox.value || "").trim();
              noteBox.value = base ? (base + "\n\n" + txt) : txt;
            }

            setStatus("Texte généré" + (selectedDomain ? (" — filtre: " + selectedDomain) : "") + ".");
            return txt;
          }

          buildDomainSelect(domains, function (newDomain) {
            selectedDomain = newDomain;
            renderControls(parameters, phrases, stateValues, stateEnabled, selectedDomain);
            setStatus(selectedDomain ? ("Filtre: " + selectedDomain) : "Tous les domaines.");
            previewEl.textContent = "";
          });

          renderControls(parameters, phrases, stateValues, stateEnabled, selectedDomain);

          $("btnPreview").addEventListener("click", function () { doPreview(); });

          $("btnClear").addEventListener("click", function () {
            previewEl.textContent = "";
            noteBox.value = "";
            setStatus("Effacé.");
          });

          $("btnCopy").addEventListener("click", async function () {
            var text = (noteBox.value || "").trim();
            if (!text) {
              doPreview();
              text = (noteBox.value || "").trim();
            }
            var ok = await copyToClipboard(text, noteBox);
            setStatus(ok ? "Copié dans le presse-papiers ✅" : "Impossible de copier (politique de sécurité) ❌");
          });

          setStatus("Prêt.");
        } catch (err) {
          console.error(err);
          setStatus("Erreur: " + err.message);
        }
      }

      if (document.readyState === "loading") document.addEventListener("DOMContentLoaded", main);
      else main();
    })();
  </script>
</body>
</html>
